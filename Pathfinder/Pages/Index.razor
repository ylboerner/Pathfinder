@page "/"
@using Pathfinder.Services
@using Pathfinder.Constants
@inject ISnackbar _snackbar
@inject ICompilationService _compilationService

<PageTitle>Index</PageTitle>

<MudGrid>
    <MudItem xs="12">
        <MudText Typo="Typo.body1" GutterBottom="true">A FHIRPath evaluation kit, powered by the Firely .NET SDK</MudText>
        <MudTextField @bind-Value="FhirPathInput" TextChanged="OnInputChanged" T="string" MaxLength="1000" HelperText="Enter your FHIRPath here" Immediate="true" Label="FHIRPath" Variant="Variant.Text"/>
    </MudItem>
    <MudItem xs="12">
        <MudTextField @bind-Value="Output" T="string" Variant="Variant.Text" Lines="10"/>
    </MudItem>
    <MudItem xs="12">
        <MudTextField @bind-Value="ResourceInput" TextChanged="OnInputChanged" T="string" Label="Paste your resource as JSON" Variant="Variant.Text" Lines="30"/>
    </MudItem>
</MudGrid>

@code
{
    private string? FhirPathInput { get; set; } = DefaultValues.FhirPath;

    private string? ResourceInput { get; set; } = DefaultValues.Resource;
    
    private string? Output { get; set; }

    private void OnInputChanged()
    {
        if (FhirPathInput == null)
        {
            Output = "FHIRPath input is empty.";
            return;
        }
        
        if (ResourceInput == null)
        {
            Output = "Resource input is empty.";
            return;
        }

        Output = _compilationService.Compile(FhirPathInput, ResourceInput);
    }
}
